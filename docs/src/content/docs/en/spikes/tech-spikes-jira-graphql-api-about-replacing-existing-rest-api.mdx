---
title: Spike calling jira with graphQL API
description: Jira graphQL API about replacing existing REST API.
---

## Current situation

The existing jira API are all REST API, and the REST API has the problem of over-fetching or multiple requests.

## Expect

Jira graphQL API about replacing existing REST API.

## Scope of impact
By checking, in the JiraControl layer, some interface makes multiple calls to the REST API to retrieve the required data. So, in graphQL API, we can call an API to get some required data, reducing the remote call.

## Solutions
Jira provides the functionality of the graphQL API, which provides us with an API to get a variety of data at once and return only the data we need.

## Example


### 一、For heartbeat's API `/boards/{boardType}/verify`
Jira's API `/rest/agile/1.0/board/{boardId}` is used, but only projectKey is used in the logic.

#### Solution
Using the graphQL API instead for `/rest/agile/1.0/board/{boardId}`, as follows:
```json
API:
POST: https://dorametrics.atlassian.net/jsw2/graphql
Schema:
query queryProjectKey($boardId: ID!){
  boardScope(boardId: $boardId) {
    projectLocation{
      key
    }
  }
}
Query Variables
{
"boardId": "2"
}
```

### 二、For heartbeat's API `/boards /{boardType}` and `/boards /{boardType}/info`
Using the jira's REST API as follows:
1. `/rest/agile/1.0/board/{boardId}/configuration`, to obtain the board id, name attribute, column name, and status id.
2. `/rest/api/2/status/{statusNum}`, to get the untranslatedName of status and the key and name of category.
3.  `/rest/agile/1.0/board/{boardId}/issue`, to get all cards on the board, but some card fields are missing.

#### Solution
1. Using the graphQL API instead for `/rest/agile/1.0/board/{boardId}/configuration` and `rest/api/2/status/{statusNum}`, as follows:
```json
API:
POST: https://dorametrics.atlassian.net/jsw2/graphql
Schema:
query myboard($boardId: ID!){
  boardScope(boardId: $boardId) {
		board{
			columns{
				id
				name
				columnStatus{
					status{
						id
						name
            category
					}
				}
    }
  }
}

Query Variables
{
  "boardId": "2"
}
```
As we can see, the REST API needs to call the interface twice to get the required value, and graphQL API only needs to call once.

2. Using the graphQL API instead for `/rest/agile/1.0/board/{boardId}/issue`, as follows:

```json
API:
POST: https://dorametrics.atlassian.net/jsw2/graphql
Schema:
query myboard($boardId: ID!){
  boardScope(boardId: $boardId) {
		board{
			reports{
				urlName
			}
			project{
				id
				name
				key
			}
			columns{
				cards{
					estimate{
						storyPoints
					}
					parentId
					priority{
						name
					}
					id
					dueDate
					fixVersions
					issue{
						labels
						activeSprint{
							name
						}
						type{
							name
						}
						summary
						assignee{
							displayName
						}
						id
						status{
							name
						}
					}
				}
			}
		}
  }
}
Query Variables
{
  "boardId": "2"
}
```
With this graphQL API replacement, the fields required in the project are the `statusCategoryChangeDate` and `customFields`, which require further investigation.

As you can see from graphQL API above, these three rest apis can be replaced by a single graphQL API, simply by modifying the schema.

## Question
There are three other interfaces to the REST API for jira that do not support graphQL API replacement. as follows:

1. `/rest/internal/2/issue/{jiraCardKey}/activityfeed`, no query history card record was found in the current data.

2. `/rest/api/2/issue/createmeta`, no way to query.

3. `/rest/api/2/project/{projectIdOrKey}`, the graphQL API returns a style of `TEAM_MANAGED_PROJECT` and `COMPANY_MANAGED_PROJECT`，not in the style we need.

## Test jira graphQL API
Here are three apis you can use to test jira's graphQL, as follows:
1. https://dorametrics.atlassian.net/jsw/graphql

2. https://dorametrics.atlassian.net/rest/gira/1/

3. https://dorametrics.atlassian.net/gateway/api/graphql

We can copy the header from the jira page to test graphQL API.
